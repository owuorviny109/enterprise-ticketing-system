<div class="dashboard">
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <div class="breadcrumb">
      <span>üè†</span>
      <span>/</span>
      <span>Dashboard</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading">
    <!-- Metrics Cards -->
    <div class="metrics-grid">
      <div *ngFor="let metric of metrics" class="metric-card" [style.border-left-color]="metric.color">
        <div class="metric-content">
          <div class="metric-header">
            <h3>{{ metric.title }}</h3>
          </div>
          <div class="metric-value">{{ metric.value }}</div>
          <div class="metric-percentage">
            <div class="percentage-circle" [style.background-color]="metric.bgColor">
              <span [style.color]="metric.color">{{ metric.percentage }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-row">
        <!-- Ticket by Department -->
        <div class="chart-card">
          <h3>Tickets by Department</h3>
          <div class="pie-chart-container" *ngIf="departmentData.length > 0; else noDataTemplate">
            <div class="pie-chart">
              <svg width="150" height="150" viewBox="0 0 150 150">
                <circle 
                  *ngFor="let dept of departmentData; let i = index"
                  cx="75" 
                  cy="75" 
                  r="60" 
                  fill="none" 
                  [attr.stroke]="dept.color" 
                  stroke-width="20" 
                  [attr.stroke-dasharray]="calculateStrokeDashArray(dept.percentage)"
                  [attr.stroke-dashoffset]="calculateStrokeDashOffset(getCumulativePercentage(departmentData, i))"
                  transform="rotate(-90 75 75)"/>
              </svg>
            </div>
            <div class="chart-legend">
              <div *ngFor="let dept of departmentData" class="legend-item">
                <div class="legend-color" [style.background-color]="dept.color"></div>
                <span>{{ dept.name }} {{ dept.percentage }}% ({{ dept.count }})</span>
              </div>
            </div>
          </div>
          <ng-template #noDataTemplate>
            <div class="no-data">
              <p>No department data available</p>
            </div>
          </ng-template>
        </div>

        <!-- Ticket by Type -->
        <div class="chart-card">
          <h3>Tickets by Type</h3>
          <div class="pie-chart-container" *ngIf="ticketTypeData.length > 0; else noTypeDataTemplate">
            <div class="pie-chart">
              <svg width="150" height="150" viewBox="0 0 150 150">
                <circle 
                  *ngFor="let type of ticketTypeData; let i = index"
                  cx="75" 
                  cy="75" 
                  r="60" 
                  fill="none" 
                  [attr.stroke]="type.color" 
                  stroke-width="20" 
                  [attr.stroke-dasharray]="calculateStrokeDashArray(type.percentage)"
                  [attr.stroke-dashoffset]="calculateStrokeDashOffset(getCumulativePercentage(ticketTypeData, i))"
                  transform="rotate(-90 75 75)"/>
              </svg>
            </div>
            <div class="chart-legend">
              <div *ngFor="let type of ticketTypeData" class="legend-item">
                <div class="legend-color" [style.background-color]="type.color"></div>
                <span>{{ type.name }} {{ type.percentage }}% ({{ type.count }})</span>
              </div>
            </div>
          </div>
          <ng-template #noTypeDataTemplate>
            <div class="no-data">
              <p>No ticket type data available</p>
            </div>
          </ng-template>
        </div>

        <!-- Top Ticket Creators -->
        <div class="chart-card">
          <h3>Top Ticket Creators</h3>
          <div class="pie-chart-container" *ngIf="topCreators.length > 0; else noCreatorDataTemplate">
            <div class="pie-chart">
              <svg width="150" height="150" viewBox="0 0 150 150">
                <circle 
                  *ngFor="let creator of topCreators; let i = index"
                  cx="75" 
                  cy="75" 
                  r="60" 
                  fill="none" 
                  [attr.stroke]="creator.color" 
                  stroke-width="20" 
                  [attr.stroke-dasharray]="calculateStrokeDashArray(creator.percentage)"
                  [attr.stroke-dashoffset]="calculateStrokeDashOffset(getCumulativePercentage(topCreators, i))"
                  transform="rotate(-90 75 75)"/>
              </svg>
            </div>
            <div class="chart-legend">
              <div *ngFor="let creator of topCreators" class="legend-item">
                <div class="legend-color" [style.background-color]="creator.color"></div>
                <span>{{ creator.name }} {{ creator.percentage }}% ({{ creator.count }})</span>
              </div>
            </div>
          </div>
          <ng-template #noCreatorDataTemplate>
            <div class="no-data">
              <p>No creator data available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Bottom Section -->
      <div class="bottom-section">
        <!-- Ticket Summary -->
        <div class="chart-card ticket-summary">
          <h3>Ticket Summary</h3>
          <div class="summary-stats">
            <div class="summary-item">
              <div class="summary-value">{{ totalTickets }}</div>
              <div class="summary-label">Total Tickets</div>
            </div>
            <div class="summary-item">
              <div class="summary-value">{{ metrics[0].value }}</div>
              <div class="summary-label">New Tickets</div>
            </div>
            <div class="summary-item">
              <div class="summary-value">{{ metrics[1].value }}</div>
              <div class="summary-label">Open Tickets</div>
            </div>
            <div class="summary-item">
              <div class="summary-value">{{ metrics[2].value }}</div>
              <div class="summary-label">Closed Tickets</div>
            </div>
          </div>
        </div>

        <!-- Response Times and Stats -->
        <div class="stats-section">
          <div class="stat-card response-time-card">
            <h3>System Status</h3>
            <div class="status-indicator">
              <div class="status-dot active"></div>
              <span>System Online</span>
            </div>
            <div class="system-stats">
              <div class="stat-item">
                <span class="stat-label">Uptime:</span>
                <span class="stat-value">99.9%</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Response:</span>
                <span class="stat-value">< 2s</span>
              </div>
            </div>
          </div>

          <div class="stat-card customers-card">
            <h3>CUSTOMERS</h3>
            <div class="customer-count">
              <span class="count-value">{{ customers }}</span>
              <div class="count-icon">üë•</div>
            </div>
            <div class="count-subtitle">Active customers</div>
          </div>

          <div class="stat-card contacts-card">
            <h3>CONTACTS</h3>
            <div class="contact-count">
              <span class="count-value">{{ contacts }}</span>
              <div class="count-icon">üìû</div>
            </div>
            <div class="count-subtitle">Total contacts</div>
          </div>

          <div class="stat-card departments-card">
            <h3>DEPARTMENTS</h3>
            <div class="department-count">
              <span class="count-value">{{ departmentData.length }}</span>
              <div class="count-icon">üè¢</div>
            </div>
            <div class="count-subtitle">Active departments</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>